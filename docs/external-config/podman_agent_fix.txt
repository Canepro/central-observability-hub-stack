# Fix: Add environment variable to set mode to flow
# The 'run' subcommand is for Flow mode, but sometimes the entrypoint needs help or the arguments are being parsed weirdly.
# The error "-config.file flag required" suggests it might be starting in Static mode (Prometheus Agent) instead of Flow mode.
# In v0.39+, setting AGENT_MODE=flow environment variable is safer.

podman rm -f grafana-agent

podman run -d \
  -v $(pwd)/podman-agent.river:/etc/agent/config.river \
  --name grafana-agent \
  --network host \
  --privileged \
  -e AGENT_MODE=flow \
  -v /run/user/$(id -u)/podman/podman.sock:/run/podman/podman.sock \
  grafana/agent:v0.39.1 run /etc/agent/config.river

