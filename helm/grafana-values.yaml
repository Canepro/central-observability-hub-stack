# Grafana Helm Chart Values
# Chart: grafana/grafana
# Version: 7.3.0+
# App Version: 12.x

# ArgoCD/Helm render safeguard: allow admin password in values (prefer secret/env in production)
assertNoLeakedSecrets: false

# Deployment configuration
replicas: 1
image:
  repository: grafana/grafana
  tag: 11.1.0  # Pinning to a stable version to avoid 'uid' schema errors
  pullPolicy: IfNotPresent

# Persistence
persistence:
  enabled: true
  type: pvc
  storageClassName: oci-bv
  accessModes:
    - ReadWriteOnce
  size: 50Gi

# Service configuration
service:
  type: ClusterIP
  port: 80

# Resource limits for Always Free tier
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 1
    memory: 1Gi

# Grafana configuration
grafana.ini:
  server:
    root_url: https://grafana.canepro.me
  security:
    admin_user: admin
    admin_password: admin  # Change on first login
    secret_key: "observability-hub-secret-key" # Static key to prevent encryption/DB errors

# Datasource provisioning
datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://prometheus-server.monitoring.svc.cluster.local:80
        isDefault: true
        editable: true
      - name: Loki
        type: loki
        access: proxy
        url: http://loki-gateway.monitoring.svc.cluster.local
        editable: true
      - name: Tempo
        type: tempo
        access: proxy
        url: http://tempo.monitoring.svc.cluster.local:3200
        editable: true
